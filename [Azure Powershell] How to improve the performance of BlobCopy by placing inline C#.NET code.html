<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>[Azure Powershell] How to improve the performance of BlobCopy by placing inline C#.NET code</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/Maheshk [MSFT]' target='_blank'>Maheshk [MSFT]</a>
<time>    4/17/2017 10:45:00 PM</time>
<hr>
<div id='content'><p class="WordSection1">Performance issues are always hard and tricky to fix. Recently I had this ask to check why the <em>given</em> Powershell execution takes time and gets slower on heavy iteration. In the beginning, copy operation used to take only few mins but over a heavy iteration, we saw the performance degraded to 2x, 3x..  <p class="WordSection1">Sample looping of copy command,  <p>&nbsp;&nbsp;&nbsp; foreach($SrcBlob in $SrcBlobs)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $DestBlob = "root/" + $SrcBlob.Name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://msdn.microsoft.com/en-us/library/mt617167(v=azure.98).aspx" target="_blank">Start-AzureStorageBlobCopy</a> -SrcBlob $SrcBlob.Name -SrcContainer $SrcContainerName -Context $SrcContext -DestBlob $DestBlob -DestContainer $DestContainerName -DestContext $DestContext -Force <br>&nbsp;&nbsp;&nbsp; }<br></p> <p class="WordSection1">We have also used measure-command to list the execution duration and print the value for each iteration and also the sum at the end of the loop to confirm. We ran the loop by copying 5000+ times b/w storage accounts and found that, the Powershell command let execution gets slower on iteration for some reason.&nbsp; Later on investigation, we confirmed this was due to known limitation with Powershell.  <p>&nbsp;&nbsp; $CopyTime = <a href="https://technet.microsoft.com/en-us/library/ee176899.aspx" target="_blank">Measure-Command</a>{ <p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Start-AzureStorageBlobCopy</b> -SrcBlob $SrcBlob.Name -SrcContainer $SrcContainerName -Context $SrcContext -DestBlob $DestBlob -DestContainer $DestContainerName -DestContext $DestContext -Force  <p>&nbsp;&nbsp;&nbsp; } <p>Yes, there is a known issue with PowerShell running slow while iterating large loops due to the nature how PowerShell works, as in the 16<sup>th</sup> time of the iteration the content of the loop must be compiled dynamically and the .Net will need to run some extra checks. Thanks for some of our internal folks to provide clarity on this. To overcome this, there is a workaround suggested which is what we are here. Yes, we replaced with .Net code having copy logic inside the Powershell script to improve the performance. In this way, the security check only running once instead every 16 time. You will find the detailed information here â€“&gt; Why cant PowerShell run loops fast ? <a title="https://blogs.msdn.microsoft.com/anantd/2014/07/25/why-cant-powershell-run-loops-fast/" href="https://blogs.msdn.microsoft.com/anantd/2014/07/25/why-cant-powershell-run-loops-fast/">https://blogs.msdn.microsoft.com/anantd/2014/07/25/why-cant-powershell-run-loops-fast/</a> <p><strong>How to place the C# as inline code within Powershell:-</strong> <p class="WordSection1"><font face="Courier New"><font size="3"><span>$<span class="SpellE">reflib</span></span><span> <span style="color: darkgray">=</span> (<span style="color: blue">get-item</span> <span style="color: darkred">"c:\temp\Microsoft.WindowsAzure.Storage.dll"</span>)<span style="color: darkgray">.</span><span class="SpellE">fullname</span></span></font></font> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><font face="Courier New"><font size="3"><span>[</span><span>void</span><span>][</span><span class="SpellE"><span>reflection.assembly</span></span><span>]::</span><span class="SpellE"><span>LoadFrom</span></span><span>(<span style="color: orangered">$<span class="SpellE">reflib</span></span>)</span></font></font></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><font face="Courier New"><font size="3"><span>$Source</span><span> <span style="color: darkgray">=</span> <span style="color: darkred">@"</span></span></font></font></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">using <span class="SpellE">Microsoft.WindowsAzure.Storage</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">using <span class="SpellE">Microsoft.WindowsAzure.Storage.Auth</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">using <span class="SpellE">Microsoft.WindowsAzure.Storage.Blob</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">using System;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><strong><span><font face="Courier New"><font size="3">namespace ns</font></font></span><span><font face="Courier New"><font size="3">{</font></font></span></strong></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><strong>public static class copyfn1</strong></font></font></span><span><font face="Courier New"><font size="3"><strong>{</strong></font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><strong>&nbsp;&nbsp; public static void <span class="SpellE">Copy_bw_SA_Blobs_Test</span>(string <span class="SpellE">sourceAccountKey</span>, string <span class="SpellE">destAcKey</span>, string <span class="SpellE">SrcSAName</span>, string <span class="SpellE">DestSAName</span>, string <span class="SpellE">SrcContainerName</span>, string <span class="SpellE">DestContainerName</span>, string <span class="SpellE">SrcPrefix</span>, string <span class="SpellE">DestPrefix</span>)</strong></font></font></span><span><font face="Courier New"><font size="3"><strong>{</strong></font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StorageCredentials</span> <span class="SpellE">scSrc</span> = new <span class="SpellE">StorageCredentials</span>(<span class="SpellE">SrcSAName</span>, <span class="SpellE">sourceAccountKey</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudStorageAccount</span> <span class="SpellE">srcAc</span> = new <span class="SpellE">CloudStorageAccount</span>(<span class="SpellE">scSrc</span>, true);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlobClient</span> <span class="SpellE">cbcSrc</span> = <span class="SpellE">srcAc.CreateCloudBlobClient</span>();</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlobContainer</span> <span class="SpellE">contSrc</span> = <span class="SpellE">cbcSrc.GetContainerReference</span>(<span class="SpellE">SrcContainerName</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Generate SAS Key and use it for delegate access</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SharedAccessBlobPolicy</span> <span class="SpellE">sasConstraints</span> = new <span class="SpellE">SharedAccessBlobPolicy</span>();</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sasConstraints.SharedAccessExpiryTime</span> = <span class="SpellE">DateTime.UtcNow.AddHours</span>(24);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sasConstraints.Permissions</span> = <span class="SpellE">SharedAccessBlobPermissions.Write</span></font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | <span class="SpellE">SharedAccessBlobPermissions.List</span> | <span class="SpellE">SharedAccessBlobPermissions.Add</span></font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | <span class="SpellE">SharedAccessBlobPermissions.Delete</span> | <span class="SpellE">SharedAccessBlobPermissions.Create</span></font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | <span class="SpellE">SharedAccessBlobPermissions.Read</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string <span class="SpellE">sasContainerToken</span> = <span class="SpellE">contSrc.GetSharedAccessSignature</span>(<span class="SpellE">sasConstraints</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span><font size="3" face="Courier New"></font></span></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Return the URI string for the container, including the SAS token.</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string <span class="SpellE">containersas</span> = <span class="SpellE">contSrc.Uri</span> + <span class="SpellE">sasContainerToken</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlobContainer</span> container = new <span class="SpellE">CloudBlobContainer</span>(new Uri(<span class="SpellE">containersas</span>));</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Destination account - no SAS <span class="SpellE">reqd</span></font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StorageCredentials</span> <span class="SpellE">scDst</span> = new <span class="SpellE">StorageCredentials</span>(<span class="SpellE">DestSAName</span>, <span class="SpellE">destAcKey</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudStorageAccount</span> <span class="SpellE">DstAc</span> = new <span class="SpellE">CloudStorageAccount</span>(<span class="SpellE">scDst</span>, true);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlobClient</span> <span class="SpellE">cbcDst</span> = <span class="SpellE">DstAc.CreateCloudBlobClient</span>();</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlobContainer</span> <span class="SpellE">contDst</span> = <span class="SpellE">cbcDst.GetContainerReference</span>(<span class="SpellE">DestContainerName</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach</span> (<span class="SpellE">var</span> <span class="SpellE">eachblob</span> in <span class="SpellE">container.ListBlobs</span>(<span class="SpellE">SrcPrefix</span>, true, <span class="SpellE">BlobListingDetails.Copy</span>))</font></font></span><span><font face="Courier New"><font size="3">{</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlob</span> <span class="SpellE">srcBlob</span> = (<span class="SpellE">CloudBlob</span>)<span class="SpellE">eachblob</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string <span class="SpellE">srcpath</span> = <span class="SpellE">srcBlob.Name</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string <span class="SpellE">dstpath</span> = (<span class="SpellE">DestPrefix</span> != "") ? <span class="SpellE">srcpath.Replace</span>(<span class="SpellE">SrcPrefix</span>, <span class="SpellE">DestPrefix</span>) : <span class="SpellE">srcpath</span>;</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span><span class="SpellE">Console.WriteLine</span>("Files copying-" + <span class="SpellE">dstpath</span>);</span></font></font></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font size="3" face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (<span class="SpellE">srcBlob.BlobType</span> == <span class="SpellE">BlobType.BlockBlob</span>)</font></font></span><span><font face="Courier New"><font size="3">{</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudBlockBlob</span> <span class="SpellE">dstblob</span> = <span class="SpellE">contDst.GetBlockBlobReference</span>(<span class="SpellE">dstpath</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dstblob.StartCopy</span>((<span class="SpellE">CloudBlockBlob</span>)<span class="SpellE">srcBlob</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (<span class="SpellE">srcBlob.BlobType</span> == <span class="SpellE">BlobType.AppendBlob</span>)</font></font></span><span><font face="Courier New"><font size="3">{</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudAppendBlob</span> <span class="SpellE">dstblob</span> = <span class="SpellE">contDst.GetAppendBlobReference</span>(<span class="SpellE">dstpath</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dstblob.StartCopy</span>((<span class="SpellE">CloudAppendBlob</span>)<span class="SpellE">srcBlob</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (<span class="SpellE">srcBlob.BlobType</span> == <span class="SpellE">BlobType.PageBlob</span>)</font></font></span><span><font face="Courier New"><font size="3">{</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CloudPageBlob</span> <span class="SpellE">dstblob</span> = <span class="SpellE">contDst.GetPageBlobReference</span>(<span class="SpellE">dstpath</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><span></span><font face="Courier New"><font size="3"><span class="SpellE">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dstblob.StartCopy</span>((<span class="SpellE">CloudPageBlob</span>)<span class="SpellE">srcBlob</span>);</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp; }</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3">&nbsp; }</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font face="Courier New"><font size="3">}</font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><font size="3" face="Courier New">"@</font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><font face="Courier New"><font size="3"><span>Add-Type</span><span> <span style="color: navy">-<span class="SpellE">ReferencedAssemblies</span></span> <span style="color: orangered">$<span class="SpellE">reflib</span></span> <span style="color: navy">-<span class="SpellE">TypeDefinition</span></span> <span style="color: orangered">$Source</span> <span style="color: navy">-Language</span> <span class="SpellE"><span style="color: blueviolet">CSharp</span></span> <span style="color: navy">-<span class="SpellE">PassThru</span></span> </span></font></font></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><font face="Courier New"><font size="3"><span>[</span><span>ns.copyfn1</span><span>]::</span><span class="SpellE"><span>Copy_bw_SA_Blobs_Test</span></span><span>(<span style="color: darkred">"acc_key1"</span></span><span><span style="color: darkgray">,</span> <span style="color: darkred">"acc_key2"</span></span><span><span style="color: darkgray">,</span> <span style="color: darkred">"storage_acc1"</span></span><span><span style="color: darkgray">,</span> <span style="color: darkred">"storage_acc2"</span></span></font></font></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span style="color: darkgray">,</span> <span style="color: darkred">"<span class="SpellE">src_container_name</span>"</span></font></font></span><font face="Courier New"><font size="3"><span><span style="color: darkgray">,</span> <span style="color: darkred">"<span class="SpellE">dest_container_name</span>"</span></span><span><span style="color: darkgray">,</span> <span style="color: darkred">"sales/2017/Jan"<span> </span></span></span></font></font></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal" align="left"><span><span></span><font face="Courier New"><font size="3"><span style="color: darkgray">,</span> <span style="color: darkred">"sales/2017/backup/"</span>) </font></font></span></p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal">&nbsp;</p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal">With this inline C# code, we were able to optimize the copy time duration and also able to mitigate the&nbsp; performance degrade over a heavy loop. </p> <p class="MsoNormal" style="margin-bottom: 0pt;background: white;line-height: normal">Let me know if this helps in someway or issue with this. </p></div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
